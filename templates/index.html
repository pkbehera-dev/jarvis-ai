<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jarvis AI Assistant</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Highlight.js CSS (Default theme) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"
    />
    <style>
      :root {
        --bg-color: #212529; /* Dark background */
        --card-bg: #343a40; /* Darker card background */
        --text-color: #f8f9fa; /* Light text */
        --chat-bg: #495057; /* Chat box background */
        --user-msg-bg: #0d6efd; /* Bootstrap primary blue */
        --user-msg-text: #fff;
        --ai-msg-bg: #6c757d; /* Bootstrap secondary gray */
        --ai-msg-text: #fff;
        --input-bg: #495057;
        --input-border: #6c757d;
        --btn-primary-bg: #0d6efd;
        --btn-primary-hover-bg: #0b5ed7;
        --scroll-thumb: #6c757d;
        --scroll-track: #495057;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        transition: background-color 0.3s ease;
      }

      .card {
        background-color: var(--card-bg);
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        overflow: hidden;
      }

      .card-header {
        background-color: var(--card-bg);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-color);
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        padding: 1.5rem;
      }

      .chat-box {
        height: 60vh;
        overflow-y: auto;
        background-color: var(--chat-bg);
        padding: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        scroll-behavior: smooth;
      }

      /* Custom Scrollbar */
      .chat-box::-webkit-scrollbar {
        width: 8px;
      }
      .chat-box::-webkit-scrollbar-track {
        background: var(--scroll-track);
        border-radius: 10px;
      }
      .chat-box::-webkit-scrollbar-thumb {
        background: var(--scroll-thumb);
        border-radius: 10px;
      }
      .chat-box::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      .message-container {
        display: flex;
        margin-bottom: 15px;
        animation: fadeIn 0.5s ease-out;
      }

      .user-message {
        background-color: var(--user-msg-bg);
        color: var(--user-msg-text);
        padding: 12px 18px;
        border-radius: 20px 20px 5px 20px;
        margin-left: auto;
        max-width: 80%;
        word-wrap: break-word;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .assistant-message {
        background-color: var(--ai-msg-bg);
        color: var(--ai-msg-text);
        padding: 12px 18px;
        border-radius: 20px 20px 20px 5px;
        margin-right: auto;
        max-width: 80%;
        word-wrap: break-word;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        position: relative;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .form-control {
        background-color: var(--input-bg);
        color: var(--text-color);
        border: 1px solid var(--input-border);
        border-radius: 25px;
        padding: 12px 20px;
        transition: all 0.3s ease;
      }
      .form-control:focus {
        background-color: var(--input-bg);
        color: var(--text-color);
        border-color: var(--btn-primary-bg);
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
      }

      .btn-primary {
        background-color: var(--btn-primary-bg);
        border-color: var(--btn-primary-bg);
        border-radius: 25px;
        padding: 12px 25px;
        font-weight: bold;
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        background-color: var(--btn-primary-hover-bg);
        border-color: var(--btn-primary-hover-bg);
        transform: translateY(-2px);
      }
      .btn-primary:active {
        transform: translateY(0);
      }

      /* Code Block Styling */
      .assistant-message pre {
        background-color: #282c34; /* Darker background for code */
        border-radius: 8px;
        padding: 15px;
        margin-top: 10px;
        overflow-x: auto;
        position: relative;
        padding-top: 35px; /* Space for copy button */
      }
      .assistant-message pre code {
        font-family: "Fira Code", "Consolas", "Monaco", monospace;
        font-size: 0.9em;
      }
      .copy-button {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #555;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.75em;
        z-index: 10;
        transition: background-color 0.3s ease;
      }
      .copy-button:hover {
        background-color: #777;
      }

      /* Markdown Styling */
      .assistant-message h1,
      .assistant-message h2,
      .assistant-message h3,
      .assistant-message h4,
      .assistant-message h5,
      .assistant-message h6 {
        color: var(--text-color);
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 0.3rem;
      }
      .assistant-message ul,
      .assistant-message ol {
        margin-left: 25px;
        margin-bottom: 1rem;
        line-height: 1.6;
      }
      .assistant-message strong {
        font-weight: bold;
        color: var(--user-msg-bg); /* Highlight strong text */
      }
      .assistant-message em {
        font-style: italic;
        color: var(--ai-msg-text); /* Highlight italic text */
      }
      .assistant-message p {
        margin-bottom: 1rem;
      }
      .response-time {
        font-size: 0.7em;
        color: rgba(255, 255, 255, 0.5);
        text-align: right;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container d-flex flex-column vh-100">
      <div class="card flex-grow-1">
        <div class="card-header">Jarvis AI</div>
        <div class="card-body chat-box" id="chat-box">
          <!-- Chat history will be loaded here -->
        </div>
        <div class="card-footer bg-dark border-top border-secondary">
          <form id="chat-form" class="d-flex" autocomplete="off">
            <input
              type="text"
              id="user_input"
              name="user_input"
              class="form-control me-2"
              placeholder="Type your message here..."
              required
            />
            <button type="submit" class="btn btn-primary">Send</button>
          </form>
        </div>
      </div>
      <footer class="text-center text-white-50 mt-3">
        <p>&copy; 2025 Jarvis AI. All Rights Reserved. | <a href="/privacy-terms" class="text-white-50">Privacy & Terms</a></p>
        <p>Created with ❤️ by Pradyumna</p>
      </footer>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Highlight.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.0/marked.min.js"></script>
    <script>
      document
        .getElementById("chat-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const userInput = document.getElementById("user_input").value;
          const chatBox = document.getElementById("chat-box");

          // Display user message immediately
          const userMessageContainer = document.createElement("div");
          userMessageContainer.className =
            "message-container justify-content-end";
          const userMessageDiv = document.createElement("div");
          userMessageDiv.className = "user-message";
          userMessageDiv.textContent = userInput;
          userMessageContainer.appendChild(userMessageDiv);
          chatBox.appendChild(userMessageContainer);
          chatBox.scrollTop = chatBox.scrollHeight;

          document.getElementById("user_input").value = ""; // Clear input

          fetch("/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "user_input=" + encodeURIComponent(userInput),
          })
            .then((response) => response.json())
            .then((data) => {
              const assistantMessageContainer = document.createElement("div");
              assistantMessageContainer.className =
                "message-container justify-content-start";
              const assistantMessageDiv = document.createElement("div");
              assistantMessageDiv.className = "assistant-message";

              // Parse Markdown to HTML for all responses
              assistantMessageDiv.innerHTML = marked.parse(data.response);

              // Add copy button to code blocks and highlight them
              const codeBlocks =
                assistantMessageDiv.querySelectorAll("pre code");
              codeBlocks.forEach((codeBlock) => {
                const copyButton = document.createElement("button");
                copyButton.className = "copy-button";
                copyButton.textContent = "Copy";
                copyButton.onclick = () => {
                  navigator.clipboard
                    .writeText(codeBlock.textContent)
                    .then(() => {
                      copyButton.textContent = "Copied!";
                      setTimeout(() => (copyButton.textContent = "Copy"), 2000);
                    })
                    .catch((err) => {
                      console.error("Failed to copy: ", err);
                    });
                };
                codeBlock.parentNode.insertBefore(
                  copyButton,
                  codeBlock.parentNode.firstChild
                ); // Insert before pre tag
                hljs.highlightElement(codeBlock); // Highlight with Highlight.js
              });

              assistantMessageContainer.appendChild(assistantMessageDiv);
              chatBox.appendChild(assistantMessageContainer);
              chatBox.scrollTop = chatBox.scrollHeight;

              // Display response time
              if (data.response_time !== undefined) {
                const timeDiv = document.createElement("div");
                timeDiv.className = "response-time";
                timeDiv.textContent = `Response time: ${data.response_time}s`;
                assistantMessageDiv.appendChild(timeDiv);
              }
            });
        });
    </script>
  </body>
</html>
